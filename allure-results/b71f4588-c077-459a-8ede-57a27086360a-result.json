{"name": "Lighthouse Audit → what_we_do", "status": "failed", "statusDetails": {"message": "AssertionError: Lighthouse audit failed for **what_we_do**:\n  • Performance: 50.0% < 80.0%", "trace": "url = 'https://www.paveddigital.com/what-we-do'\nrequest = <FixtureRequest for <Function test_lighthouse_audit[https://www.paveddigital.com/what-we-do-what_we_do]>>, page_name = 'what_we_do'\n\n    @pytest.mark.parametrize(\n        \"url, page_name\",\n        [\n            (\"https://www.paveddigital.com/\", \"homepage\"),\n            (\"https://www.paveddigital.com/why-us\", \"why_us\"),\n            (\"https://www.paveddigital.com/what-we-do\", \"what_we_do\"),\n            (\"https://www.paveddigital.com/join-us\", \"join_us\"),\n            (\"https://www.paveddigital.com/contact-us\", \"contact_us\"),\n        ],\n        ids=lambda x: x[1] if isinstance(x, tuple) else None,\n        # ids=[\"homepage\", \"why_us\", \"what_we_do\", \"join_us\", \"contact_us\"]\n    \n    )\n    @allure.epic(\"Performance & Quality\")\n    @allure.feature(\"Lighthouse Audits\")\n    @allure.title(\"Lighthouse Audit → {page_name}\")\n    \n    def test_lighthouse_audit(url, request, page_name):\n        \"\"\"\n        Full Lighthouse audit with thresholds and rich Allure reporting.\n        `run_lighthouse` fixture should return (json_path, html_path)\n        \"\"\"\n    \n        # timestamp hiện tại\n        timestamp_str = datetime.now().strftime(\"%Y%m%d_%H%M%S\")\n    \n            # sanitize tên file từ request.node.name\n        safe_name = re.sub(r\"[^a-zA-Z0-9_-]\", \"_\", request.node.name)\n        base_name = f\"{timestamp_str}_{safe_name}\"\n    \n        # safe_name = quote_plus(url)\n    \n    \n        with allure.step(f\"Running Lighthouse audit for {page_name} → {url}\"):\n            json_path, html_path = run_lighthouse(url, report_dir=\"lighthouse_reports\")\n    \n            with open(json_path, \"r\", encoding=\"utf-8\") as f:\n                report = json.load(f)\n    \n            # Extract scores (score is 0–1, convert to %)\n            scores = {\n                \"Performance\": report[\"categories\"][\"performance\"][\"score\"] * 100,\n                \"Accessibility\": report[\"categories\"][\"accessibility\"][\"score\"] * 100,\n                \"Best Practices\": report[\"categories\"][\"best-practices\"][\"score\"] * 100,\n                \"SEO\": report[\"categories\"][\"seo\"][\"score\"] * 100,\n            }\n    \n            # Attach full HTML report (clickable in Allure!)\n            with open(html_path, \"rb\") as f:\n                allure.attach(\n                    f.read(),\n                    name=f\"Lighthouse Report - {page_name}\",\n                    attachment_type=AttachmentType.HTML,\n                    extension=\"html\",\n                )\n    \n            # Dynamic Allure description with nice formatting\n            allure.dynamic.description(f\"\"\"\n            **Lighthouse Audit Results — {page_name}**\n            **URL:** {url}\n    \n            | Category          | Score   | Status       |\n            |-------------------|---------|--------------|\n            | Performance       | {scores['Performance']:.1f}% | {'Good' if scores['Performance'] >= 90 else 'Fail'} |\n            | Accessibility     | {scores['Accessibility']:.1f}% | {'Good' if scores['Accessibility'] >= 90 else 'Warning'} |\n            | Best Practices    | {scores['Best Practices']:.1f}% | {'Good' if scores['Best Practices'] >= 90 else 'Warning'} |\n            | SEO               | {scores['SEO']:.1f}% | {'Good' if scores['SEO'] >= 90 else 'Warning'} |\n    \n            Double-click the attachment above to open the full interactive Lighthouse report.\n            \"\"\")\n    \n            # Fail the test if any critical threshold is not met\n            failures = []\n    \n            if scores[\"Performance\"] < PERFORMANCE_THRESHOLD * 100:\n                failures.append(f\"Performance: {scores['Performance']:.1f}% < {PERFORMANCE_THRESHOLD*100}%\")\n    \n            if scores[\"Accessibility\"] < ACCESSIBILITY_THRESHOLD * 100:\n                failures.append(f\"Accessibility: {scores['Accessibility']:.1f}% < {ACCESSIBILITY_THRESHOLD*100}%\")\n    \n            if failures:\n                allure.dynamic.severity(allure.severity_level.CRITICAL)\n>               raise AssertionError(\n                    f\"Lighthouse audit failed for **{page_name}**:\\n\" + \"\\n\".join(f\"  • {f}\" for f in failures)\n                )\nE               AssertionError: Lighthouse audit failed for **what_we_do**:\nE                 • Performance: 50.0% < 80.0%\n\nroot/tests/test_performance_all_pages.py:291: AssertionError"}, "description": "\n        **Lighthouse Audit Results — what_we_do**  \n        **URL:** https://www.paveddigital.com/what-we-do\n\n        | Category          | Score   | Status       |\n        |-------------------|---------|--------------|\n        | Performance       | 50.0% | Fail |\n        | Accessibility     | 94.0% | Good |\n        | Best Practices    | 77.0% | Warning |\n        | SEO               | 100.0% | Good |\n\n        Double-click the attachment above to open the full interactive Lighthouse report.\n        ", "steps": [{"name": "Running Lighthouse audit for what_we_do → https://www.paveddigital.com/what-we-do", "status": "failed", "statusDetails": {"message": "AssertionError: Lighthouse audit failed for **what_we_do**:\n  • Performance: 50.0% < 80.0%\n", "trace": "  File \"/Users/ashley/Downloads/test-selenium-python/lighthouse_performance_test/root/tests/test_performance_all_pages.py\", line 291, in test_lighthouse_audit\n    raise AssertionError(\n        f\"Lighthouse audit failed for **{page_name}**:\\n\" + \"\\n\".join(f\"  • {f}\" for f in failures)\n    )\n"}, "attachments": [{"name": "Lighthouse Report - what_we_do", "source": "231126f9-8ef7-4945-8e09-759f33a7a29f-attachment.html", "type": "text/html"}], "start": 1764776215217, "stop": 1764776242310}], "attachments": [{"name": "stdout", "source": "7a1ecd64-9a8e-48a6-8691-800f34741f4d-attachment.txt", "type": "text/plain"}], "parameters": [{"name": "url", "value": "'https://www.paveddigital.com/what-we-do'"}, {"name": "page_name", "value": "'what_we_do'"}], "start": 1764776215217, "stop": 1764776242310, "uuid": "1e24cab6-5c78-488a-a038-5da0f022c63d", "historyId": "ef5fac7e97cb4576cc2ad9776ebab14d", "testCaseId": "6d8ac5e08b4dadad0b56ba032d5ffe58", "fullName": "root.tests.test_performance_all_pages#test_lighthouse_audit", "labels": [{"name": "severity", "value": "critical"}, {"name": "feature", "value": "Lighthouse Audits"}, {"name": "epic", "value": "Performance & Quality"}, {"name": "parentSuite", "value": "root.tests"}, {"name": "suite", "value": "test_performance_all_pages"}, {"name": "host", "value": "192.168.102.11"}, {"name": "thread", "value": "92886-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "root.tests.test_performance_all_pages"}]}